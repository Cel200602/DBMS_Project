{% extends "base.html" %}

{% block content %}
<h2>Incident Status</h2>
<a href="{{ url_for('user_incidents') }}">Back to Incidents</a>

<div class="status-card">
    <h3>{{ incident.title }}</h3>
    <p><strong>Status:</strong> <span class="status-{{ incident.status|lower }}">{{ incident.status }}</span></p>
    <p><strong>Priority:</strong> <span class="priority-{{ incident.priority|lower }}">{{ incident.priority }}</span>
    </p>
    <p><strong>Risk Level:</strong> {{ incident.risk_level }}</p>
    <p><strong>Description:</strong> {{ incident.description }}</p>
    <p><strong>Full Status Details:</strong> <span id="status-detail">Processing...</span></p>
</div>

<h3>Verification History & Updates</h3>
{% if updates %}
<ul class="timeline">
    {% for update in updates %}
    <li>
        <strong>{{ update.timestamp.strftime('%Y-%m-%d %H:%M') }}</strong>: {{ update.update_text }}
    </li>
    {% endfor %}
</ul>
{% else %}
<p>No updates yet.</p>
{% endif %}

<script>
    // Example of dynamic status detail based on status
    const status = "{{ incident.status }}";
    const detailSpan = document.getElementById('status-detail');
    if (status === 'Reported') detailSpan.textContent = "Incident received, pending verification.";
    else if (status === 'Verified') detailSpan.textContent = "Incident verified, assigned to handler.";
    else if (status === 'Handling') detailSpan.textContent = "Investigation and mitigation in progress.";
    else if (status === 'Closed') detailSpan.textContent = "Incident resolved and closed.";
</script>
{% endblock %}